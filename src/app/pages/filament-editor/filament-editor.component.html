<ng-container>
    <nav class="cs-page-header w-full">
        <div>
            <div class="navbar-default">
                <ul>
                    <app-control-up-button></app-control-up-button>
                    <button class="cs-button danger" (click)="delete()"
                        *ngIf="this.filament && this.filament.id > 0">Delete</button>
                </ul>
            </div>
        </div>
    </nav>

    <div class="cs-card error" *ngIf="errorMessage">
        <div class="cs-heading h1">Something went wrong...</div>
        <p>{{errorMessage}}</p>
    </div>

    <div class="full-screen-photo flex flex-col" *ngIf="showPhotoDialog" (click)="showPhotoDialog = false">
        <div class="flex-grow"></div>

        <img class="filament-photo" [attr.src]="photoUri" *ngIf="photoUri">

        <div class="flex-grow"></div>
    </div>

    <ng-container *ngIf="!showPhotoDialog">
        <div class="cs-card photo-card" *ngIf="filament && filament.id >= 0">
            <div class="filament-photo-div bg-slate-300">
                <div>
                    <img class="filament-photo" [attr.src]="photoUri" *ngIf="photoUri">
                </div>
                <button class="cs-button zoom" (click)="showPhotoDialog = true">Zoom</button>
            </div>

            <form class="photo-form" id="photo-form">
                <div class="cs-input-block">
                    <label for="weight">
                        Current weight (g)
                    </label>
                    <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="weight" type="number"
                        autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                        placeholder="Current weight" [(ngModel)]="filament.weight">
                </div>

                <div class="cs-input-block">
                    <label for="photo" class="cs-button">
                        Upload a new photo
                    </label>
                    <input class="hidden" id="photo" type="file" autocomplete="off" spellcheck="false" autocorrect="off"
                        autocapitalize="off" (change)="onUploadFile($event)">
                </div>
            </form>
        </div>
        <div class="buttons">
            <button type="submit" class="cs-button save-button" (click)="save()">Save</button>
        </div>

        <div class="cs-card" *ngIf="filament && filament.id < 0">
            <p>You must save the filament once before you can upload a photo.</p>
        </div>

        <div class="cs-tab-box" *ngIf="filament; else noFilament">
            <div class="cs-tab-buttons">
                <button class="cs-tab-button" [class.active]="selectedTab === 'summary'" 
                        [class.inactive]="selectedTab !== 'summary'" 
                        (click)="selectedTab = 'summary'">
                    Summary
                </button>
                <button class="cs-tab-button" [class.active]="selectedTab === 'details'" 
                        [class.inactive]="selectedTab !== 'details'" 
                        (click)="selectedTab = 'details'">
                    Details
                </button>
            </div>

            <div class="cs-tab-content" *ngIf="selectedTab === 'summary'">
                <div class="cs-card">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Brand</span>
                            <span class="text-base">{{filament.brand || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Kind</span>
                            <span class="text-base">{{filament.kind || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Description</span>
                            <span class="text-base">{{filament.description || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Container</span>
                            <span class="text-base">{{filament.storagebox?.name || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Current Weight</span>
                            <span class="text-base">{{filament.weight ? filament.weight + ' g' : 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Initial Weight</span>
                            <span class="text-base">{{filament.initialWeight ? filament.initialWeight + ' g' : 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Price per KG</span>
                            <span class="text-base">{{filament.pricePerKG ? 'â‚¬' + filament.pricePerKG : 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Remaining</span>
                            <span class="text-base">{{filament.weight && filament.initialWeight ? ((filament.weight / filament.initialWeight * 100).toFixed(1) + '%') : 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Color 1</span>
                            <div class="flex items-center gap-2">
                                <div *ngIf="filament.color1" class="w-6 h-6 rounded border border-gray-300" 
                                     [style.background-color]="filament.color1"></div>
                                <span class="text-sm">{{filament.color1 || 'N/A'}}</span>
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Color 2</span>
                            <div class="flex items-center gap-2">
                                <div *ngIf="filament.color2" class="w-6 h-6 rounded border border-gray-300" 
                                     [style.background-color]="filament.color2"></div>
                                <span class="text-sm">{{filament.color2 || 'N/A'}}</span>
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">First Added</span>
                            <span class="text-base">{{filament.firstAdded || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm text-gray-500">Last Updated</span>
                            <span class="text-base">{{filament.lastUpdated || 'N/A'}}</span>
                        </div>
                        <div class="flex flex-col col-span-2 md:col-span-4" *ngIf="filament.notes">
                            <span class="font-semibold text-sm text-gray-500">Notes</span>
                            <span class="text-base whitespace-pre-wrap">{{filament.notes}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cs-tab-content" *ngIf="selectedTab === 'details'">
                <div class="cs-card">
                    <form class="filament-form" id="filament-form">
                        <div class="fields">

                    <div class="columns-1 md:columns-3">
                        <div class="cs-input-block">
                            <label for="brand">
                                Brand
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="initialWeight"
                                type="text" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                                placeholder="Brand" [(ngModel)]="filament.brand">
                        </div>
                        <div class="cs-input-block">
                            <label for="kind">
                                Kind
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="kind" type="text"
                                autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                                placeholder="Kind" [(ngModel)]="filament.kind">
                        </div>
                        <div class="cs-input-block">
                            <label for="pricePerKG">
                                Price per kg
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="pricePerKG"
                                type="number" autocomplete="off" spellcheck="false" autocorrect="off"
                                autocapitalize="off" placeholder="Price per KG" [(ngModel)]="filament.pricePerKG">
                        </div>
                    </div>


                    <div class="cs-input-block">
                        <label for="description">
                            Description
                        </label>
                        <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="description" type="text"
                            autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                            placeholder="Description" [(ngModel)]="filament.description">
                    </div>

                    <div class="columns-1 md:columns-2">
                        <div class="cs-input-block"
                            *ngIf="storageboxes && storageboxes.length > 0; else noStorageboxes">
                            <label for="storageboxSelection">
                                Container
                            </label>

                            <select id="storageboxSelection" title="Pick a container" #classTemplate
                                (change)="onChangeBox($event, classTemplate.value)" [(ngModel)]="filament.storagebox"
                                [ngModelOptions]="{standalone: true}" class="cs-input-text"
                                placeholder="Pick a container">
                                <option *ngFor="let c of storageboxes" [ngValue]="c">{{c.name}}</option>
                            </select>
                        </div>
                        <ng-template #noStorageboxes>
                            <p>You have no containers defined. Click <a
                                    [routerLink]="['..', 'storagebox', '-1']">here</a>
                                to
                                add one.</p>
                        </ng-template>
                        <div class="cs-input-block">
                            <label for="initialWeight">
                                Initial weight (g)
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text" id="initialWeight"
                                type="number" autocomplete="off" spellcheck="false" autocorrect="off"
                                autocapitalize="off" placeholder="Initial weight" [(ngModel)]="filament.initialWeight">
                        </div>
                    </div>
                    <div class="columns-1 md:columns-2">
                        <div class="cs-input-block">
                            <label for="color1">
                                Color 1 <span class="cs-button small" (click)="filament.color1 = ''">Clear</span>
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text p-6 min-h-16" id="color1"
                                type="color" autocomplete="off" spellcheck="false" autocorrect="off"
                                autocapitalize="off" [attr.placeholder]="filament.color1" [(ngModel)]="filament.color1">
                            <div class="text-xs"><i>{{filament.color1}}</i></div>
                        </div>
                        <div class="cs-input-block">
                            <label for="color2">
                                Color 2 <span class="cs-button small" (click)="filament.color2 = ''">Clear</span>
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-text p-6 min-h-16" id="color1"
                                type="color" autocomplete="off" spellcheck="false" autocorrect="off"
                                autocapitalize="off" [attr.placeholder]="filament.color2" [(ngModel)]="filament.color2">
                            <div class="text-xs"><i>{{filament.color2}}</i></div>
                        </div>
                    </div>

                    <div class="columns-1 md:columns-2">
                        <div class="cs-input-block">
                            <label for="firstAdded">
                                First added ({{filament.firstAdded}})
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-date" id="firstAdded"
                                type="date" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                                placeholder="Initial weight" [(ngModel)]="filament.firstAdded">
                        </div>
                        <div class="cs-input-block">
                            <label for="lastUpdated">
                                Last updated ({{filament.lastUpdated}})
                            </label>
                            <input [ngModelOptions]="{standalone: true}" class="cs-input-date" id="lastUpdated"
                                type="date" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                                placeholder="Initial weight" [(ngModel)]="filament.lastUpdated">
                        </div>
                    </div>
                    <div class="cs-input-block">
                        <label for="notes">
                            Notes
                        </label>
                        <textarea [ngModelOptions]="{standalone: true}" class="cs-input-text" id="notes" type="text"
                            autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"
                            placeholder="Enter your notes" [(ngModel)]="filament.notes"></textarea>
                    </div>
                </div>
                <div class="buttons">
                    <button type="submit" class="cs-button save-button" (click)="save()">Save</button>
                </div>
            </form>
                </div>
            </div>
        </div>
    </ng-container>

    <ng-template #noFilament>
        <div class="cs-card">
            <p>The specified ID does not represent any currently registered roll of filament.</p>
        </div>
    </ng-template>

</ng-container>